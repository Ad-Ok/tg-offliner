# Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ´Ğ¾ĞºĞ°Ñ‡ĞºĞ°) ĞºĞ°Ğ½Ğ°Ğ»Ğ°

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0  
**Ğ”Ğ°Ñ‚Ğ°:** 14 Ñ„ĞµĞ²Ñ€Ğ°Ğ»Ñ 2026

---

## ğŸ“‹ Ğ¦ĞµĞ»ÑŒ

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ¾ĞºĞ°Ñ‡ĞºĞ¸ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ğ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² Ğ¸Ğ· Telegram ĞºĞ°Ğ½Ğ°Ğ»Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑƒĞ¶Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° â€” ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ²Ğ¸Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°/ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.

---

## ğŸ¯ Scope

### Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾

| Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---------|----------|
| **ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾ÑÑ‚Ñ‹** | ĞŸĞ¾ÑÑ‚Ñ‹ Ñ `telegram_id > max(telegram_id)` Ğ² Ğ‘Ğ” |
| **ĞĞ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸** | ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ¸Ğ· discussion group Ñ `telegram_id > max` |
| **ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ°** | ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ², Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ, Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ° Ğ¸ Ñ‚.Ğ´. |
| **ĞœĞµĞ´Ğ¸Ğ°** | ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ¾Ñ‚Ğ¾/Ğ²Ğ¸Ğ´ĞµĞ¾/Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² |
| **Gallery layouts** | ĞĞ²Ñ‚Ğ¾Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼ĞµĞ´Ğ¸Ğ°-Ğ³Ñ€ÑƒĞ¿Ğ¿ (Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ…) |

### ĞĞµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾ (v1)

- ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ²
- ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ²
- Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¹ Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ°Ñ…

---

## ğŸ”„ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ (UX Flow)

### Ğ”Ğ²ÑƒÑ…ÑˆĞ°Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ: Check â†’ Confirm â†’ Sync

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ĞºĞ°Ğ½Ğ°Ğ»Ğ° (ChannelsList.vue)         â”‚
â”‚                                             â”‚
â”‚  llamatest  Â·  17 Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ²  Â·  24 ĞºĞ¾Ğ¼Ğ¼.     â”‚
â”‚                                             â”‚
â”‚  [Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ â–¼]  [ğŸ”„ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ]  [ğŸ—‘]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ ĞºĞ»Ğ¸Ğº
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°...  â³                            â”‚
â”‚  (GET /api/sync/check/{channel_id})         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Ğ¾Ñ‚Ğ²ĞµÑ‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸                       â”‚
â”‚                                             â”‚
â”‚  ğŸ“Š ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾:                               â”‚
â”‚  Â· 15 Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ²                          â”‚
â”‚  Â· ~30 Ğ½Ğ¾Ğ²Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² (Ğ¾Ñ†ĞµĞ½ĞºĞ°)          â”‚
â”‚  Â· ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸          â”‚
â”‚                                             â”‚
â”‚  [ĞÑ‚Ğ¼ĞµĞ½Ğ°]  [â–¶ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ...  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  12/15       â”‚
â”‚  (POST /api/sync/start/{channel_id})        â”‚
â”‚                                             â”‚
â”‚  ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ: 12 Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Â· 8 ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²      â”‚
â”‚  [â¹ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸

Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ» ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ â€” Ğ¿Ñ€Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ğ¸ "Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ" Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ **Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾** (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ check â†’ confirm â†’ sync). ĞĞ¾ Ğ¿Ğ¾ÑĞºĞ¾Ğ»ÑŒĞºÑƒ ÑƒĞ¶Ğµ ÑĞºĞ°Ñ‡Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑÑ‚Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ğ‘Ğ”, `max(telegram_id)` Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹ÑˆĞµ â†’ ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸ĞµÑÑ Ğ½Ğ¾Ğ²Ñ‹Ğµ.

### Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸

| Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ | ĞšĞ½Ğ¾Ğ¿ĞºĞ° | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
|-----------|--------|----------|
| Idle | `ğŸ”„ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ` | Ğ—Ğ°Ğ¿ÑƒÑĞº check |
| Checking | `â³ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°...` (disabled) | â€” |
| Summary shown | `â–¶ Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ` (Ğ² Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞµ/dropdown) | Ğ—Ğ°Ğ¿ÑƒÑĞº sync |
| Syncing | `â¹ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ` | Stop sync |
| No new posts | `âœ… ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾` (fade out Ñ‡ĞµÑ€ĞµĞ· 3 ÑĞµĞº) | â€” |

---

## ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞĞ¾Ğ²Ñ‹Ğµ backend endpoints

#### 1. `GET /api/sync/check/<channel_id>`

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ±ĞµĞ· ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ.**

ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ `max(telegram_id)` Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `posts` Ğ´Ğ»Ñ `channel_id`
2. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº Telegram, Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ entity
3. ĞŸĞ¾ÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² ĞºĞ°Ğ½Ğ°Ğ»Ğµ Ñ `id > max_telegram_id`  
   (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ Telethon: `client.get_messages(entity, min_id=max_id, limit=0)` â†’ `.total`)
4. Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ discussion group â€” Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²
5. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ°, ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ñ Ğ‘Ğ”

**Request:**
```
GET /api/sync/check/llamatest
```

**Response:**
```json
{
  "channel_id": "llamatest",
  "status": "has_updates",
  "local": {
    "posts_count": 17,
    "comments_count": 24,
    "max_post_id": 85,
    "max_comment_id": 1250,
    "last_import_date": "2026-02-12T15:30:00"
  },
  "remote": {
    "total_messages": 32,
    "new_posts_count": 15,
    "new_posts_estimate": true,
    "discussion_group_id": 2573960761,
    "new_comments_estimate": 30
  },
  "metadata_changes": {
    "subscribers": { "old": "1,234", "new": "1,456" },
    "description": { "changed": true }
  }
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑÑ‹:** `has_updates`, `up_to_date`, `error`

#### 2. `POST /api/sync/start/<channel_id>`

**Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ´Ğ¾ĞºĞ°Ñ‡ĞºÑƒ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ².**

ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ `max(telegram_id)` Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `posts`
2. Ğ˜Ñ‚ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `client.iter_messages(entity, min_id=max_id, reverse=True)`
3. Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑÑ‚Ğ° â€” `process_message_for_api()` + `_flush_batch()`
4. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ° Ğ² Ğ‘Ğ”
5. Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ discussion group â€” Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²
6. Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ gallery layouts Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼ĞµĞ´Ğ¸Ğ°-Ğ³Ñ€ÑƒĞ¿Ğ¿
7. ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ñ‡ĞµÑ€ĞµĞ· ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ `import_state`

**Request:**
```json
POST /api/sync/start/llamatest
{
  "export_settings": {
    "include_reposts": true,
    "include_polls": true,
    "include_discussion_comments": true
  }
}
```

**Response:**
```json
{
  "message": "Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ 15 Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ğ¸ 28 ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²",
  "processed_posts": 15,
  "processed_comments": 28,
  "metadata_updated": true,
  "success": true
}
```

#### 3. `POST /api/sync/stop/<channel_id>`

Ğ ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ `should_stop` / `set_status('stopped')`.

#### 4. `GET /api/download/status/<channel_id>`

Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ endpoint â€” Ñ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.  
Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ `type: "sync" | "import"` Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹.

---

## ğŸ“Š ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Â«Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑÑ‚Ğ°Â»

### Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ: max(telegram_id)

```
Ğ‘Ğ”:      [1] [2] [3] ... [85]     â† max_id = 85
Telegram: [1] [2] [3] ... [85] [86] [87] ... [100]
                                  â†‘               â†‘
                           min_id=85          Ğ½Ğ¾Ğ²Ñ‹Ğµ
```

**ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ max telegram_id:**
```python
# Ğ’ sync-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
from models import Post
max_id = db.session.query(db.func.max(Post.telegram_id)) \
    .filter(Post.channel_id == channel_id) \
    .scalar() or 0
```

**Telethon Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ¾Ğ²Ñ‹Ñ…:**
```python
# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ñ… (Ğ±ĞµĞ· ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ)
messages = await client.get_messages(entity, min_id=max_id, limit=0)
new_count = messages.total

# Ğ˜Ñ‚ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾ÑÑ‚Ñ‹
for post in client.iter_messages(entity, min_id=max_id, reverse=True):
    # process...
```

### Ğ”Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²

ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾, Ğ½Ğ¾ Ñ `channel_id = str(discussion_group_id)`:
```python
max_comment_id = db.session.query(db.func.max(Post.telegram_id)) \
    .filter(Post.channel_id == str(discussion_group_id)) \
    .scalar() or 0
```

---

## ğŸ“‚ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…

### Backend (Python)

| Ğ¤Ğ°Ğ¹Ğ» | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ |
|------|-----------|
| `api/sync.py` | **ĞĞĞ’Ğ«Ğ™** â€” Blueprint Ñ endpoints check/start/stop |
| `telegram_export.py` | ĞĞ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `sync_channel()` (Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸Ğ· `import_channel_direct`) |
| `telegram_export.py` | ĞĞ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `sync_discussion_comments()` |
| `telegram_export.py` | ĞĞ¾Ğ²Ğ°Ñ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ `_get_max_telegram_id(channel_id)` |
| `app.py` | Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ `sync_bp` blueprint |
| `message_processing/channel_info.py` | ĞĞ¾Ğ²Ğ°Ñ `compare_channel_metadata(old, new)` Ğ´Ğ»Ñ diff Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… |

### Frontend (Nuxt)

| Ğ¤Ğ°Ğ¹Ğ» | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ |
|------|-----------|
| `services/apiV2.js` | ĞĞ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸: `checkSync()`, `startSync()`, `stopSync()` |
| `components/system/ChannelsList.vue` | ĞšĞ½Ğ¾Ğ¿ĞºĞ° Â«Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÂ» + ÑĞ²Ğ¾Ğ´ĞºĞ° + Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ |
| `components/system/SyncStatus.vue` | **ĞĞĞ’Ğ«Ğ™** â€” ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° sync |
| `components/system/DownloadStatus.vue` | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° `type: "sync"` (Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ) |

---

## ğŸ”§ Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### `sync_channel()` â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ

```python
def sync_channel(channel_id, export_settings=None):
    """
    Ğ”Ğ¾ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾ÑÑ‚Ñ‹ ĞºĞ°Ğ½Ğ°Ğ»Ğ°.
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ¼.
    """
    # 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ max telegram_id Ğ¸Ğ· Ğ‘Ğ”
    max_id = _get_max_telegram_id(channel_id)
    
    # 2. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº Telegram
    client = connect_to_telegram()
    entity, error = get_entity_by_username_or_id(client, channel_id)
    
    # 3. Ğ˜Ñ‚ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ (min_id = max_id)
    new_posts = client.iter_messages(entity, min_id=max_id, reverse=True)
    
    # 4. process_message_for_api + _flush_batch (ĞºĞ°Ğº Ğ² import)
    batch = []
    for post in new_posts:
        if should_stop_import(channel_id):
            break
        post_data = process_message_for_api(post, channel_id, client, folder_name)
        if post_data:
            batch.append(post_data)
        if len(batch) >= BATCH_SIZE:
            _flush_batch(batch)
            batch = []
    _flush_batch(batch)
    
    # 5. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ°
    _update_channel_metadata(client, entity, channel_id)
    
    # 6. Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸
    if discussion_group_id and include_comments:
        sync_discussion_comments(client, channel_id, discussion_group_id)
    
    # 7. Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ gallery layouts Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ³Ñ€ÑƒĞ¿Ğ¿
    generate_gallery_layouts_for_channel(channel_id)
```

### `_update_channel_metadata()` â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```python
def _update_channel_metadata(client, entity, channel_id):
    """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ° Ğ² Ğ‘Ğ” (Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸, Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ, Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€)."""
    channel_info = get_channel_info(client, entity, output_dir="downloads", folder_name=folder_name)
    
    with app.app_context():
        channel = Channel.query.get(channel_id)
        if channel:
            channel.subscribers = channel_info.get('subscribers')
            channel.description = channel_info.get('description')
            channel.posts_count = channel_info.get('posts_count')
            # ĞĞ²Ğ°Ñ‚Ğ°Ñ€: ÑĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ
            if channel_info.get('avatar') and channel_info['avatar'] != channel.avatar:
                channel.avatar = channel_info['avatar']
            db.session.commit()
```

### Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹

1. **ĞĞ• Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ `clear_downloads()`** â€” Ğ¿Ñ€Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¼ĞµĞ´Ğ¸Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ, Ğ° Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ
2. **ĞĞ• ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ/Ğ¿ĞµÑ€ĞµÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ» Ğ² Ğ‘Ğ”** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ
3. **`generate_gallery_layouts_for_channel()`** ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ layouts (ĞºĞ¾Ğ´ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ `Layout.query.filter_by(grouped_id=...).first()`)
4. **`_flush_batch()`** Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ as-is â€” Ğ¾Ğ½ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
5. **ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ** â€” Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `update_import_progress()` Ğ¸ `should_stop_import()`

### ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: Ñ‡Ñ‚Ğ¾ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼

| ĞŸĞ¾Ğ»Ğµ | ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼? | ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ |
|------|-----------|------------|
| `name` | âŒ ĞĞµÑ‚ | ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ³ Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² UI |
| `subscribers` | âœ… Ğ”Ğ° | Ğ’ÑĞµĞ³Ğ´Ğ° Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
| `description` | âœ… Ğ”Ğ° | Ğ¢ĞµĞºÑÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ° |
| `posts_count` | âœ… Ğ”Ğ° | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ğ² Telegram |
| `avatar` | âœ… Ğ”Ğ° | ĞŸĞµÑ€ĞµĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ |
| `creation_date` | âŒ ĞĞµÑ‚ | ĞĞµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ |
| `print_settings` | âŒ ĞĞµÑ‚ | ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ |
| `changes` | âŒ ĞĞµÑ‚ | ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ |

---

## ğŸ—“ Ğ¤Ğ°Ğ·Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

### Ğ¤Ğ°Ğ·Ğ° 1: Backend â€” Check endpoint

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `api/sync.py` blueprint
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `GET /api/sync/check/<channel_id>`
- [ ] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `_get_max_telegram_id(channel_id)`
- [ ] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ `compare_channel_metadata()`
- [ ] Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ blueprint Ğ² `app.py`
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ check endpoint

### Ğ¤Ğ°Ğ·Ğ° 2: Backend â€” Sync endpoint

- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `sync_channel()` Ğ² `telegram_export.py`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `sync_discussion_comments()` Ğ² `telegram_export.py`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `_update_channel_metadata()`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `POST /api/sync/start/<channel_id>` Ğ² `api/sync.py`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `POST /api/sync/stop/<channel_id>`
- [ ] ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ñ‡ĞµÑ€ĞµĞ· `import_state` (Ğ¿Ğ¾Ğ»Ğµ `type: "sync"`)
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ sync endpoint

### Ğ¤Ğ°Ğ·Ğ° 3: Frontend â€” UI

- [ ] API Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ² `apiV2.js`: `checkSync()`, `startSync()`, `stopSync()`
- [ ] ĞšĞ½Ğ¾Ğ¿ĞºĞ° Â«Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÂ» Ğ² `ChannelsList.vue`
- [ ] Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° diff (Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ° Ğ¸Ğ»Ğ¸ dropdown) Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
- [ ] `SyncStatus.vue` â€” Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `DownloadStatus.vue`)
- [ ] Polling Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ñ‡ĞµÑ€ĞµĞ· `GET /api/download/status/<channel_id>`
- [ ] ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹: checking, summary, syncing, done, no updates

### Ğ¤Ğ°Ğ·Ğ° 4: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

- [ ] Unit Ñ‚ĞµÑÑ‚Ñ‹: `_get_max_telegram_id`, `compare_channel_metadata`
- [ ] Integration Ñ‚ĞµÑÑ‚: sync Ñ mock Telethon
- [ ] Ğ¢ĞµÑÑ‚ Ğ½Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¼ ĞºĞ°Ğ½Ğ°Ğ»Ğµ `llamatest`: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‚ Ğ² ĞºĞ°Ğ½Ğ°Ğ» â†’ sync â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
- [ ] Ğ¢ĞµÑÑ‚ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°

---

## âš ï¸ Edge cases

| Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ | ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| ĞšĞ°Ğ½Ğ°Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ” | 404 â€” "ĞšĞ°Ğ½Ğ°Ğ» Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½" |
| ĞĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² | `status: "up_to_date"` â†’ ĞºĞ½Ğ¾Ğ¿ĞºĞ° "âœ… ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾" |
| Telegram Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ | 503 â€” "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº Telegram" |
| ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚/ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | 409 â€” "ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ¶Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ" (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ `import_state`) |
| ĞšĞ°Ğ½Ğ°Ğ» ÑÑ‚Ğ°Ğ» Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¼ | 403 â€” "ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ°Ğ½Ğ°Ğ»Ñƒ" |
| Discussion group Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ | ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `discussion_group_id` Ğ² Ğ‘Ğ” |
| ĞŸĞ¾ÑÑ‚Ñ‹ Ñ `grouped_id` (Ğ°Ğ»ÑŒĞ±Ğ¾Ğ¼Ñ‹) | Ğ’ÑĞµ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ°Ğ»ÑŒĞ±Ğ¾Ğ¼Ğ° Ğ¿Ğ¾Ğ¿Ğ°Ğ´ÑƒÑ‚ Ğ¿Ğ¾ `min_id`, layout Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ |
| ĞŸÑƒÑÑ‚Ğ¾Ğ¹ ĞºĞ°Ğ½Ğ°Ğ» (0 Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ğ² Ğ‘Ğ”) | `max_id = 0` â†’ ÑĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ²ÑĞµ (ÑĞºĞ²Ğ¸Ğ²Ğ°Ğ»ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°) |
| Sync Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ import | `max_id` ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ ÑƒĞ¶Ğµ ÑĞºĞ°Ñ‡Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ÑÑ‚Ñ‹ â†’ Ğ´Ğ¾ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ğº |

---

## ğŸ“š ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ API

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ (Ğ½ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)

```
GET /api/sync/check/llamatest

200 OK
{
  "channel_id": "llamatest",
  "status": "up_to_date",
  "local": {
    "posts_count": 17,
    "comments_count": 24,
    "max_post_id": 85
  },
  "remote": {
    "total_messages": 17,
    "new_posts_count": 0,
    "new_comments_estimate": 0
  },
  "metadata_changes": {}
}
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° (ĞµÑÑ‚ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ)

```
GET /api/sync/check/llamatest

200 OK
{
  "channel_id": "llamatest",
  "status": "has_updates",
  "local": {
    "posts_count": 17,
    "comments_count": 24,
    "max_post_id": 85
  },
  "remote": {
    "total_messages": 32,
    "new_posts_count": 15,
    "new_comments_estimate": 30
  },
  "metadata_changes": {
    "subscribers": { "old": "150", "new": "200" }
  }
}
```

### Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

```
POST /api/sync/start/llamatest
Content-Type: application/json

{
  "export_settings": {
    "include_reposts": true,
    "include_polls": true,
    "include_discussion_comments": true
  }
}

200 OK
{
  "success": true,
  "processed_posts": 15,
  "processed_comments": 28,
  "metadata_updated": true,
  "message": "Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ 15 Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ² Ğ¸ 28 ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²"
}
```

### ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ (Ñ‡ĞµÑ€ĞµĞ· ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ endpoint)

```
GET /api/download/status/llamatest

200 OK
{
  "status": "downloading",
  "type": "sync",
  "details": {
    "processed_posts": 8,
    "total_posts": 15,
    "processed_comments": 3,
    "started_at": 1739520000
  }
}
```
