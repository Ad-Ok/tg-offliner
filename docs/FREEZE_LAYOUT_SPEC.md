# Freeze Layout Feature - –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

**–î–∞—Ç–∞:** 28 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

## üéØ –¶–µ–ª–∏

### –ö–æ–Ω–µ—á–Ω–∞—è —Ü–µ–ª—å
–ü–æ–ª—É—á–∏—Ç—å **IDML**, –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π preview

### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å  
–ü–æ–ª—É—á–∏—Ç—å **PDF**, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π preview

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ü–µ–ª—å
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–±–∏—Ç—ã–π –Ω–∞ **—Å—Ç—Ä–∞–Ω–∏—Ü—ã preview**

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

1. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞:**
   - –†–∞–∑–±–∏–µ–Ω–∏–µ –ª–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —É—á–µ—Ç–æ–º `print-config.json`
   - **–ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π - –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏**
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–º–µ—é—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ (–æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞), –Ω–æ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ (–Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–∞–ª–µ—Ä–µ–π –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫

2. **Freeze Layout:**
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ flow layout –≤ absolute positioning
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö (–∏–∑ print-config)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ `pages`)

3. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è UI:**
   - Lazy loading —Å—Ç—Ä–∞–Ω–∏—Ü (–ø–æ 20 —à—Ç—É–∫)
   - –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ"
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

4. **–≠–∫—Å–ø–æ—Ä—Ç:**
   - PDF —Å —Ç–æ—á–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏–∑ frozen layout
   - IDML —Å —Ç–æ—á–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∏–∑ frozen layout

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ

1. **Performance:**
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 20 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑
   - –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ frozen layouts

2. **–ë–î:**
   - –¢–∞–±–ª–∏—Ü–∞ `pages` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è frozen layouts
   - –ò–µ—Ä–∞—Ä—Ö–∏—è: `page_number` ‚Üí `posts[]` ‚Üí `elements[]`
   - –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã + –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—Ç–µ–∫—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≥–∞–ª–µ—Ä–µ–∏)

3. **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:**
   - –ï–¥–∏–Ω–∏—Ü—ã: –º–∏–ª–ª–∏–º–µ—Ç—Ä—ã (–∏–∑ print-config.json)
   - –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –ª–µ–≤–æ–≥–æ —É–≥–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –° —É—á–µ—Ç–æ–º margins –∏–∑ `Channel.print_settings`

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```mermaid
graph TD
    A[Posts Array] --> B{Has Comments?}
    B -->|Yes| C[Group: Post + Comments]
    B -->|No| D[Single Post]
    C --> E[Check Page Height]
    D --> E
    E -->|Fits| F[Add to Current Page]
    E -->|Overflow| G[Start New Page]
    G --> H[Mark with page-break-before]
    F --> I[Continue]
```

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–±–∏–µ–Ω–∏—è

```javascript
function paginateContent(posts, pageConfig) {
  const pages = [];
  let currentPage = createNewPage(1, pageConfig);
  
  // –ü–ª–æ—Å–∫–∏–π –º–∞—Å—Å–∏–≤: –≥–ª–∞–≤–Ω—ã–µ –ø–æ—Å—Ç—ã + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
  const flatItems = [];
  
  posts.forEach(post => {
    // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–∞–≤–Ω—ã–π –ø–æ—Å—Ç
    flatItems.push({
      type: 'post',
      data: post,
      isComment: false,
      element: null
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É
    if (post.comments && post.comments.length > 0) {
      post.comments.forEach(comment => {
        flatItems.push({
          type: 'comment',
          data: comment,
          isComment: true,
          parentPostId: post.telegram_id,
          element: null
        });
      });
    }
  });
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
  flatItems.forEach(item => {
    // 1. –†–µ–Ω–¥–µ—Ä–∏–º –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π container –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è
    const tempContainer = renderToTempContainer(item);
    item.height = tempContainer.offsetHeight;
    item.element = tempContainer;
    
    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –ª–∏ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    if (currentPage.height + item.height > currentPage.maxHeight) {
      // –ù–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è - –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      
      // –í–ê–ñ–ù–û: –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã,
      // –ø–æ–º–µ—á–∞–µ–º –µ–≥–æ –¥–ª—è –æ—Å–æ–±–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä–∞–∑–±–∏–µ–Ω–∏–µ)
      if (item.height > currentPage.maxHeight) {
        console.warn(`–≠–ª–µ–º–µ–Ω—Ç ${item.type} ${item.data.telegram_id} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (${item.height}px > ${currentPage.maxHeight}px)`);
        // TODO: –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —á–∞—Å—Ç–∏
      }
      
      pages.push(currentPage);
      currentPage = createNewPage(pages.length + 1, pageConfig);
      item.pageBreakBefore = true;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    currentPage.items.push(item);
    currentPage.height += item.height;
  });
  
  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  if (currentPage.items.length > 0) {
    pages.push(currentPage);
  }
  
  return pages;
}

function createNewPage(number, pageConfig) {
  return {
    number: number,
    items: [],
    height: 0,
    maxHeight: pageConfig.height - pageConfig.margins.top - pageConfig.margins.bottom
  };
}
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π - –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```html
<div class="mb-6">
  <!-- –ì–ª–∞–≤–Ω—ã–π –ø–æ—Å—Ç -->
  <div class="post-container" data-post-id="2344">
    <div class="post"><!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞ --></div>
    <div class="post-footer"><!-- –†–µ–∞–∫—Ü–∏–∏ --></div>
  </div>
  
  <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–∫–∞–∂–¥—ã–π - –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç) -->
  <div class="ml-8 mt-4">
    <div class="post-container" data-post-id="5286" data-is-comment="true">
      <div class="post"><!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è --></div>
    </div>
    <div class="post-container" data-post-id="5287" data-is-comment="true">
      <div class="post"><!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è --></div>
    </div>
  </div>
</div>
```

**–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```javascript
function flattenPostsAndComments(container) {
  const flatItems = [];
  
  // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≥–ª–∞–≤–Ω—ã–µ –ø–æ—Å—Ç—ã –∏ –≥—Ä—É–ø–ø—ã
  const mainBlocks = container.querySelectorAll('.mb-6');
  
  mainBlocks.forEach(block => {
    // 1. –ì–ª–∞–≤–Ω—ã–π –ø–æ—Å—Ç
    const mainPost = block.querySelector('.post-container:not([data-is-comment])');
    if (mainPost) {
      flatItems.push({
        type: 'post',
        element: mainPost,
        telegram_id: mainPost.dataset.postId,
        isComment: false,
        indent: 0
      });
    }
    
    // 2. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    const comments = block.querySelectorAll('.post-container[data-is-comment="true"]');
    comments.forEach(comment => {
      flatItems.push({
        type: 'comment',
        element: comment,
        telegram_id: comment.dataset.postId,
        isComment: true,
        parentPostId: mainPost?.dataset.postId,
        indent: 32 // ml-8 = 32px = ~8.47mm
      });
    });
  });
  
  return flatItems;
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –æ—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ (`ml-8` = 32px)
- –ö–∞–∂–¥—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–∂–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –î–ª–∏–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –¥–ª–∏–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã

---

### 2. Freeze Layout

```mermaid
graph TD
    A[Page Array] --> B[For Each Page]
    B --> C[Render in Temp Container]
    C --> D[Get Element Bounds]
    D --> E[Convert to MM]
    E --> F[Make Relative to Page Top]
    F --> G[Apply position: absolute]
    G --> H[Save to pages table]
```

#### –ê–ª–≥–æ—Ä–∏—Ç–º freeze

```javascript
async function freezePage(page, pageConfig) {
  const frozenElements = [];
  
  // 1. –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (page-break)
  const pageTop = page.walls[0].container.getBoundingClientRect().top;
  
  // 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ wall –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  page.walls.forEach(wall => {
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º main post
    const postRect = wall.mainPost.getBoundingClientRect();
    frozenElemPosts = [];
  
  // 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∞–º–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (page.element –∏–∑ Paged.js)
  const pageRect = page.element.getBoundingClientRect();
  
  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±—É–¥—É—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∞ –Ω–µ viewport!
  
  // 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  page.items.forEach(item => {
    const container = item.element;
    const containerRect = container.getBoundingClientRect();
    
    // –í—ã—á–∏—Ç–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –ø–æ–ª—É—á–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã!
    const postBounds = {
      top: pxToMm(containerRect.top - pageRect.top) + pageConfig.margins.top,
      left: pxToMm(containerRect.left - pageRect.left) + pageConfig.margins.left,
      width: pxToMm(containerRect.width),
      height: pxToMm(containerRect.height)
    };
    
    // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç–∞ –≤ frozen layout
    const frozenPost = {
      telegram_id: item.data.telegram_id,
      type: item.isComment ? 'comment' : 'post',
      parent_post_id: item.parentPostId || null,
      bounds: postBounds,
      elements: []
    };
    
    // 3. –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    
    // –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏
    const textElements = container.querySelectorAll('p, .post-body, .post-header');
    textElements.forEach(el => {
      const rect = el.getBoundingClientRect();
      frozenPost.elements.push({
        type: 'text',
        selector: el.className,
        bounds: {
          top: pxToMm(rect.top - pageRect.top) + pageConfig.margins.top,
          left: pxToMm(rect.left - pageRect.left) + pageConfig.margins.left,
          width: pxToMm(rect.width),
          height: pxToMm(rect.height)
        },
        content: el.textContent.trim()
      });
    });
    
    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const imageElements = container.querySelectorAll('img');
    imageElements.forEach(el => {
      const rect = el.getBoundingClientRect();
      frozenPost.elements.push({
        type: 'image',
        selector: el.className,
        bounds: {
          top: pxToMm(rect.top - pageRect.top) + pageConfig.margins.top,
          left: pxToMm(rect.left - pageRect.left) + pageConfig.margins.left,
          width: pxToMm(rect.width),
          height: pxToMm(rect.height)
        },
        src: el.src,
        alt: el.alt
      });
    });
    
    // –ì–∞–ª–µ—Ä–µ–∏
    const galleryContainers = container.querySelectorAll('.gallery-container');
    galleryContainers.forEach(gallery => {
      const rect = gallery.getBoundingClientRect();
      const galleryItems = gallery.querySelectorAll('.gallery-item');
      
      frozenPost.elements.push({
        type: 'gallery',
        bounds: {
          top: pxToMm(rect.top - pageRect.top) + pageConfig.margins.top,
          left: pxToMm(rect.left - pageRect.left) + pageConfig.margins.left,
          width: pxToMm(rect.width),
          height: pxToMm(rect.height)
        },
        items: Array.from(galleryItems).map(item => {
          const itemRect = item.getBoundingClientRect();
          const img = item.querySelector('img');
          return {
            bounds: {
              top: pxToMm(itemRect.top - pageRect.top) + pageConfig.margins.top,
              left: pxToMm(itemRect.left - pageRect.left) + pageConfig.margins.left,
              width: pxToMm(itemRect.width),
              height: pxToMm(itemRect.height)
            },
            src: img?.src,
            alt: img?.alt
          };
        })
      });
    });
    
    frozenPosts.push(frozenPost);
  });
  
  return {
    page_number: page.number,
    posts: frozenPoslute Positioning

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

**1. Paged.js** ‚≠ê (–õ–£–ß–®–ò–ô –í–ê–†–ò–ê–ù–¢)
```bash
npm install pagedjs
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è HTML
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CSS @page rules
- ‚úÖ Hooks –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è print layouts

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```javascript
import Paged from 'pagedjs';

const paged = new Paged.Previewer();

// –†–µ–Ω–¥–µ—Ä–∏–º —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
await paged.preview(content, ['styles-pdf.css'], document.body);

// –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
const pages = paged.chunker.pages;
pages.forEach(page => {
  const elements = page.element.querySelectorAll('.post, .group');
  elements.forEach(el => {
    const bounds = el.getBoundingClientRect();
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ absolute
    el.style.position = 'absolute';
    el.style.top = `${bounds.top}px`;
    el.style.left = `${bounds.left}px`;
  });
});
```

**2. html2canvas + jsPDF**
```bash
npm install html2canvas jspdf
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –†–µ–Ω–¥–µ—Ä DOM –≤ canvas
- ‚úÖ –¢–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- ‚ùå –ù–µ –æ—á–µ–Ω—å –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è text editing

**3. CSS Grid/Flexbox + Custom Paginator**
```javascript
// –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫
class PageLayoutEngine {
  constructor(pageCon (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è):**
```json
{
  "version": "1.0",
  "channel_id": "llamasass",
  "page_size": "A4",
  "margins": [20, 20, 20, 20],
  "pages": [
    {
      "number": 1,
      "posts": [
        {
          "telegram_id": "2344",
          "type": "post",
          "parent_post_id": null,
          "bounds": {
            "top": 20,
            "left": 20,
            "width": 170,
            "height": 80
          },
          "elements": [
            {
              "type": "text",
              "selector": "post-body",
              "bounds": {"top": 25, "left": 35, "width": 140, "height": 30},
              "content": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..."
            },
            {
              "type": "image",
              "selector": "post-media",
              "bounds": {"top": 60, "left": 20, "width": 170, "height": 100},
              "src": "/downloads/llamasass/media/2344_media.jpg"
            }
          ]
        },
        {
          "telegram_id": "5286",
          "type": "comment",
          "parent_post_id": "2344",
          "bounds": {
            "top": 180,
            "left": 28.47,
            "width": 161.53,
            "height": 40
          },
          "elements": [
            {
              "type": "text",
              "selector": "post-body",
              "bounds": {"top": 185, "left": 43.47, "width": 130, "height": 20},
              "content": "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è..."
            }
          ]
        }
      ]
    },
    {
      "number": 2,
      "posts": [
        {
          "telegram_id": "5287",
          "type": "comment",
          "parent_post_id": "2344",
          "bounds": {
            "top": 20,
            "left": 28.47,
            "width": 161.53,
            "height": 40
          },
          "elements": [
            {
              "type": "text",
              "selector": "post-body",
              "bounds": {"top": 25, "left": 43.47, "width": 130, "height": 20},
              "content": "–ï—â–µ –æ–¥–∏–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ..."
            }
          ]type": "post",
          "telegram_id": "2344",
          "bounds": {
            "top": 20,
            "left": 20,
            "width": 170,
            "height": 50
          },
          "children": [
            {
              "type": "text",
              "bounds": {"top": 20, "left": 20, "width": 170, "height": 30},
              "content": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞..."
            },
            {
              "type": "image",
              "bounds": {"top": 55, "left": 20, "width": 170, "height": 100},
              "src": "/downloads/llamasass/media/2344_media.jpg"
            }
          ]
        },
        {
          "type": "comment",
          "telegram_id": "5286",
          "parent_id": "2344",
          "bounds": {
            "top": 180,
            "left": 40,
            "width": 150,
            "height": 30
          }
        }
      ]
    }
  ]
}
```

---

## üöÄ PHASE 1: PAGINATION (–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Route:** `/preview/:channelId` —Å –ø—É—Å—Ç—ã–º layout (–±–µ–∑ navbar/sidebar)
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** Paged.js –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- **Lazy loading:** –ü–æ 20 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑
- **Backend API:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Paged.js
```bash
cd tg-offliner-frontend
npm install pagedjs
```
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í `package.json` –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å `"pagedjs": "^0.5.0"`

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π layout
**–§–∞–π–ª:** `app/layouts/empty.vue`
```vue
<template>
  <div>
    <slot />
  </div>
</template>
```
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å `definePageMeta({ layout: 'empty' })` - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å navbar/sidebar

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å preview route
**–§–∞–π–ª:** `app/pages/preview/[channelId].vue`
- Layout: 'empty'
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å—Ç—ã –∫–∞–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ API
- –ü–æ–∫–∞ –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ - –ø—Ä–æ—Å—Ç–æ flow layout

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** `/preview/llamasass` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å—Ç—ã –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ

### –®–∞–≥ 4: Backend API endpoint
**–§–∞–π–ª:** `api/posts.py`
**Endpoint:** `GET /api/channels/<channel_id>/posts-with-comments`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å—Ç—ã + –∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –£—á–∏—Ç—ã–≤–∞–µ—Ç hidden —Ñ–ª–∞–≥
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** `curl http://localhost:5000/api/channels/llamasass/posts-with-comments`

### –®–∞–≥ 5: –§—É–Ω–∫—Ü–∏—è flattenPostsAndComments()
**–§–∞–π–ª:** `app/utils/pagination.js`
- –ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è Paged.js

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** Console.log –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–æ—Å–∫–∏–π –º–∞—Å—Å–∏–≤ —Å —Ñ–ª–∞–≥–∞–º–∏ isComment

### –®–∞–≥ 6: Composable usePaged()
**–§–∞–π–ª:** `app/composables/usePaged.js`
- –§—É–Ω–∫—Ü–∏—è `paginateContent(element, config)`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Paged.Previewer
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ pages

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –õ–æ–≥–∏ "Page 1", "Page 2" –≤ –∫–æ–Ω—Å–æ–ª–∏

### –®–∞–≥ 7: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤ preview route
- –ù–∞–≤–∏–≥–∞—Ü–∏—è "Previous" / "Next"
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ú–æ–∂–Ω–æ –ª–∏—Å—Ç–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –®–∞–≥ 8: Lazy loading
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤—ã—Ö 20 —Å—Ç—Ä–∞–Ω–∏—Ü
- –ö–Ω–æ–ø–∫–∞ "Load more pages"
- –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–∏—Ö 20

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù–µ —Ç–æ—Ä–º–æ–∑–∏—Ç –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–∞–Ω–∞–ª–µ

### –®–∞–≥ 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –æ—Ç—Å—Ç—É–ø–æ–º ml-8
- ‚úÖ –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- ‚úÖ –î–ª–∏–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç warning
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–ª–∞–≤–Ω–∞—è

---

## PHASE 2: FREEZE LAYOUT

### –≠—Ç–∞–ø 2: Freeze Layout (–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Paged.js
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å Preview Mode —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –ø–æ—Å—Ç–æ–≤ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å page-break –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å lazy loading (20 —Å—Ç—Ä–∞–Ω–∏—Ü)

**API Endpoints:**
- `GET /api/channels/<channel_id>/pages?page=1&limit=20` - –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `POST /api/channels/<channel_id>/paginate` - –°–æ–∑–¥–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é

**Frontend Components:**
- `PagedPreview.vue` - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –ø–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º preview
- `PageNavigator.vue` - –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- `usePagination.js` - Composable –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**Frontend Routes:**
- `/preview/:channelId` - **–ß–∏—Å—Ç—ã–π preview** –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (layout: 'empty', –±–µ–∑ navbar/sidebar)
- `/channels/:id` - –û–±—ã—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–Ω–∞–ª–∞ —Å UI

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–±–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ –≤—ã—Å–æ—Ç–µ
- [ ] –ü–æ—Å—Ç—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –Ω–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è
- [ ] Lazy loading —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–∏–¥–Ω—ã page-break –º–∞—Ä–∫–µ—Ä—ã

---

### –≠—Ç–∞–ø 2: Freeze Layout

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `freezePage()`
2. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è px ‚Üí mm
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ pages)
4. ‚úÖ UI –¥–ª—è freeze/unfreeze
5. ‚úÖ Preview frozen layout

**API Endpoints:**
- `POST /api/channels/<channel_id>/freeze` - –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å layout
- `GET /api/channels/<channel_id>/frozen` - –ü–æ–ª—É—á–∏—Ç—å frozen layout
- `DELETE /api/channels/<channel_id>/frozen` - –£–¥–∞–ª–∏—Ç—å frozen layout

**Frontend Components:**
- `FrozenLayout.vue` - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ frozen layout
- `FreezeButton.vue` - –ö–Ω–æ–ø–∫–∞ freeze/unfreeze
- `useFreeze.js` - Composable –¥–ª—è freeze logic

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑–≤–ª–µ—á–µ–Ω—ã –∏–∑ DOM
- [ ] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä—ã
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î
- [ ] Preview –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç absolute positioning
- [ ] –í–∏–∑—É–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ flow layout

---

### –≠—Ç–∞–ø 3: PDF Export (–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å frozen layout –¥–ª—è PDF
2. ‚úÖ WeasyPrint —Å absolute coordinates
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è preview

**API Endpoints:**
- `GET /api/channels/<channel_id>/export-pdf-frozen` - PDF –∏–∑ frozen layout

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] PDF —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ frozen layout
- [ ] –í–∏–∑—É–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω preview
- [ ] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–Ω—ã–µ (¬±1mm)

---

### –≠—Ç–∞–ø 4: IDML Export (–ö–æ–Ω–µ—á–Ω–∞—è —Ü–µ–ª—å)

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ IDMLBuilder –∏—Å–ø–æ–ª—å–∑—É–µ—Ç frozen layout
2. ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ mm ‚Üí points
3. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ TextFrames/Rectangles –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è preview

**API Endpoints:**
- `GET /api/channels/<channel_id>/export-idml-frozen` - IDML –∏–∑ frozen layout

**Python:**
```python
def export_idml_from_frozen(channel_id):
    # –ü–æ–ª—É—á–∞–µ–º frozen pages –∏–∑ –ë–î
    pages_records = Page.query.filter_by(channel_id=channel_id).all()
    
    for page_record in pages_records:
        frozen_data = page_record.json_data
        
        for page in frozen_data['pages']:
            builder.add_page()
            
            for element in page['elements']:
                # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º mm ‚Üí points
                bounds_pt = [
                    mm_to_points(element['bounds']['top']),
                    mm_to_points(element['bounds']['left']),
                    mm_to_points(element['bounds']['top'] + element['bounds']['height']),
                    mm_to_points(element['bounds']['left'] + element['bounds']['width'])
                ]
                
                if element['type'] == 'text':
                    builder.add_text_frame_absolute(
                        element['content'],
                        bounds_pt
                    )
                elif element['type'] == 'image':
                    builder.add_image_frame_absolute(
                        element['src'],
                        bounds_pt
                    )
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] IDML —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ frozen layout
- [ ] –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ InDesign –±–µ–∑ –æ—à–∏–±–æ–∫
- –û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –º–æ–≥—É—Ç –Ω–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É (–≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º)
- Frozen layout –ø—Ä–∏–≤—è–∑–∞–Ω –∫ page_size (re-freeze –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–æ—Ä–º–∞—Ç–∞)
- –ú–∞–∫—Å–∏–º—É–º 20 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑ (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å)
- –†–∞–∑–±–∏–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ—Å—Ç–∞ –Ω–∞ —á–∞—Å—Ç–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ
---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
tg-offliner/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ pages.py                    # –°—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã
‚îÇ   ‚îî‚îÄ‚îÄ channels.py                 # –û–±–Ω–æ–≤–∏–º –¥–ª—è frozen export
‚îú‚îÄ‚îÄ idml_export/
‚îÇ   ‚îî‚îÄ‚îÄ builder.py                  # –î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã –¥–ª—è frozen
‚îú‚îÄ‚îÄ tg-offliner-frontend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PagedPreview.vue    # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FrozenLayout.vue    # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PageNavigator.vue   # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FreezeButton.vue    # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ composables/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usePagination.js    # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useFreeze.js        # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pagesService.js     # –ù–û–í–´–ô
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ pageLayout.js       # –ù–û–í–´–ô
‚îÇ   ‚îî‚îÄ‚îÄ package.json                # –î–æ–±–∞–≤–∏–º pagedjs
‚îî‚îÄ‚îÄ FREEZE_LAYOUT_SPEC.md           # –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–†–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –Ω–∞ —á–∞—Å—Ç–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏** (split text/content across pages)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö page orientations (portrait/landscape)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã (DOCX, InCopy)

### FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–±–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü?**  
A: **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ - –¥–∞, –≤–æ–∑–º–æ–∂–Ω–æ!** –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏:
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ –≤—ã—Å–æ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü–µ—Ä–µ–Ω–æ—Å —á–∞—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —á–∞—Å—Ç—è–º–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "...–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä. X")

–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- Paged.js –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `break-inside: avoid` –∏ –º–æ–∂–µ—Ç —Ä–∞–∑–±–∏–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
- CSS Fragmentation Module Level 3 (`break-before`, `break-after`, `break-inside`)
- –†—É—á–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö "—á–∞—Å—Ç–µ–π" –ø–æ—Å—Ç–∞

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ –ø–ª–∞–Ω, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ Future Improvements.—Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [ ] `groupPostsWithComments()` - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
- [ ] `freezePage()` - freeze –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- [ ] `pxToMm()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü
- [ ] `mmToPoints()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–ª—è IDML

### Integration Tests
- [ ] API `/api/channels/<id>/paginate`
- [ ] API `/api/channels/<id>/freeze`
- [ ] API `/api/channels/<id>/export-pdf-frozen`
- [ ] API `/api/channels/<id>/export-idml-frozen`

### E2E Tests
- [ ] –ü–æ–ª–Ω—ã–π flow: Import ‚Üí Paginate ‚Üí Freeze ‚Üí Export PDF
- [ ] –ü–æ–ª–Ω—ã–π flow: Import ‚Üí Paginate ‚Üí Freeze ‚Üí Export IDML
- [ ] Lazy loading —Å—Ç—Ä–∞–Ω–∏—Ü
- [ ] –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ Preview vs PDF vs IDML

---

## üìù –ó–∞–º–µ—Ç–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ 20 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑
- –ö–µ—à–∏—Ä—É–µ–º frozen layouts –≤ –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤

### Limitations
- –ü–æ—Å—Ç + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - –Ω–µ–¥–µ–ª–∏–º—ã–π –±–ª–æ–∫ (–º–æ–∂–µ—Ç –Ω–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
- Frozen layout –ø—Ä–∏–≤—è–∑–∞–Ω –∫ page_size (re-freeze –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–æ—Ä–º–∞—Ç–∞)
- –ú–∞–∫—Å–∏–º—É–º 20 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑ (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å)

### Future Improvements
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ frozen layout (drag & drop)
- –£–º–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –±–ª–æ–∫–æ–≤ (–ø–æ—Å—Ç + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö page orientations (portrait/landscape)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã (DOCX, InCopy)

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–≠—Ç–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã freeze layout feature. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!
