# API v2 –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

## üéØ –¶–ï–õ–ò

1. **–ï–¥–∏–Ω—ã–π endpoint** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞
2. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É –±—ç–∫–µ–Ω–¥–æ–º –∏ —Ñ—Ä–æ–Ω—Ç–æ–º
4. **–ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** —É—Ä–æ–≤–Ω–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî —Å—Ç–∞—Ä—ã–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üìä –£–†–û–í–ù–ò –ù–ê–°–¢–†–û–ï–ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ò–ï–†–ê–†–•–ò–Ø –ù–ê–°–¢–†–û–ï–ö                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  –£–†–û–í–ï–ù–¨ –ü–û–°–¢–ê (Post)                                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ is_hidden: boolean        ‚Üí Edit.changes.hidden           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ edited_message: string    ‚Üí Edit.changes.message          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ print_settings: JSON      ‚Üí Post.print_settings           ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ text_columns: number                                  ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ image_placement: string                               ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ page_break_before: boolean                            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  –£–†–û–í–ï–ù–¨ –ì–ê–õ–ï–†–ï–ò (Layout)                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ cells: array              ‚Üí Layout.json_data.cells        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ border_width: string      ‚Üí Layout.json_data.border_width ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ columns: number           ‚Üí Layout.json_data.columns      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ no_crop: boolean          ‚Üí Layout.json_data.no_crop      ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  –£–†–û–í–ï–ù–¨ –ö–ê–ù–ê–õ–ê (Channel)                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ DISPLAY –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:                                        ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ sort_order: 'asc'|'desc'                              ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ items_per_chunk: number                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ EXPORT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:                                         ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ page_size: 'A4'|'A3'|...                              ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ‚îÄ margins: [top, right, bottom, left]                   ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ include_comments: boolean                             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ META (read-only):                                         ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ name, avatar, description                             ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ discussion_group_id                                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ –§–õ–û–£ –ù–ê–°–¢–†–û–ï–ö: URL vs –°–û–•–†–ê–ù–Å–ù–ù–´–ï

### –ü—Ä–∏–Ω—Ü–∏–ø: "URL –¥–ª—è sharing, DB –¥–ª—è persistence"

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ü–†–ò–û–†–ò–¢–ï–¢ –ü–ê–†–ê–ú–ï–¢–†–û–í                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  1. URL –ø–∞—Ä–∞–º–µ—Ç—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)                                   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ –î–ª—è sharing —Å—Å—ã–ª–æ–∫, –≤—Ä–µ–º–µ–Ω–Ω—ã–π override                 ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  2. –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞ (Channel.settings)            ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  3. –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)                             ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ Fallback –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–¥–∞–Ω–æ                         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§–ª–æ—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –û–¢–õ–û–ñ–ï–ù–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï (Deferred Save)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  Frontend State:                                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ currentSettings: ref({...})  // —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ savedSettings: ref({...})    // —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ –ë–î          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ hasUnsavedChanges: computed  // currentSettings !== saved ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  –§–ª–æ—É:                                                          ‚îÇ
‚îÇ  1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:                                          ‚îÇ
‚îÇ     - –ß–∏—Ç–∞–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã                                     ‚îÇ
‚îÇ     - –ó–∞–≥—Ä—É–∂–∞–µ–º savedSettings –∏–∑ API                           ‚îÇ
‚îÇ     - currentSettings = URL params || savedSettings || defaults‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, sort_order):                ‚îÇ
‚îÇ     - currentSettings.sort_order = 'asc'                       ‚îÇ
‚îÇ     - URL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: ?sort_order=asc                         ‚îÇ
‚îÇ     - hasUnsavedChanges = true                                 ‚îÇ
‚îÇ     - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ù–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (—è–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ):                               ‚îÇ
‚îÇ     - PUT /api/v2/channels/{id}/settings                       ‚îÇ
‚îÇ     - savedSettings = currentSettings                          ‚îÇ
‚îÇ     - hasUnsavedChanges = false                                ‚îÇ
‚îÇ     - URL –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ç–µ–ø–µ—Ä—å –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)       ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  4. –°–±—Ä–æ—Å –∏–∑–º–µ–Ω–µ–Ω–∏–π:                                           ‚îÇ
‚îÇ     - currentSettings = savedSettings                          ‚îÇ
‚îÇ     - URL –æ—á–∏—â–∞–µ—Ç—Å—è                                            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì° API v2 ENDPOINTS

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞ (–ì–õ–ê–í–ù–´–ô)

```
GET /api/v2/channels/{channel_id}/posts
```

**Query Parameters:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | Default | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|---------|----------|
| `sort_order` | `'asc'‚îÇ'desc'` | saved –∏–ª–∏ `'desc'` | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ |
| `chunk` | `number` | `null` | –ù–æ–º–µ—Ä chunk (null = –≤—Å–µ –ø–æ—Å—Ç—ã) |
| `items_per_chunk` | `number` | saved –∏–ª–∏ `50` | –†–∞–∑–º–µ—Ä chunk |
| `include_hidden` | `boolean` | `false` | –í–∫–ª—é—á–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø–æ—Å—Ç—ã |
| `include_comments` | `boolean` | `true` | –í–∫–ª—é—á–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |

**Response:**

```json
{
  "channel": {
    "id": "llamasass",
    "name": "Llama Sass",
    "avatar": "/downloads/llamasass/avatars/channel.jpg",
    "discussion_group_id": 1234567890,
    "settings": {
      "display": {
        "sort_order": "desc",
        "items_per_chunk": 50
      },
      "export": {
        "page_size": "A4",
        "margins": [20, 20, 20, 20]
      }
    }
  },
  
  "pagination": {
    "current_chunk": 0,
    "total_chunks": 5,
    "total_posts": 234,
    "total_comments": 89,
    "items_per_chunk": 50,
    "has_next": true,
    "has_prev": false
  },
  
  "applied_params": {
    "sort_order": "desc",
    "chunk": 0,
    "include_hidden": false,
    "source": "saved"  // "url" | "saved" | "default"
  },
  
  "posts": [
    {
      "id": 1,
      "telegram_id": 123,
      "channel_id": "llamasass",
      "date": "2025-12-25T12:00:00",
      "message": "Hello world!",
      "media_url": "/downloads/llamasass/media/123_media.jpg",
      "thumb_url": "/downloads/llamasass/thumbs/123_thumb.jpg",
      "media_type": "MessageMediaPhoto",
      "mime_type": "image/jpeg",
      
      "author": {
        "name": "Llama",
        "avatar": "/downloads/llamasass/avatars/author.jpg",
        "link": "https://t.me/llamasass"
      },
      
      "repost_author": null,
      
      "reactions": {"‚ù§Ô∏è": 10, "üëç": 5},
      
      "grouped_id": null,
      "reply_to": null,
      
      "is_hidden": false,
      "is_edited": false,
      
      "layout": null,
      
      "comments_count": 3,
      "comments": [
        {
          "id": 10,
          "telegram_id": 456,
          "channel_id": "1234567890",
          "message": "Great post!",
          "author": {...},
          "is_hidden": false
        }
      ]
    },
    
    {
      "id": 2,
      "telegram_id": 124,
      "grouped_id": 9876543210,
      
      "layout": {
        "cells": [...],
        "total_width": 100,
        "total_height": 75,
        "border_width": "2",
        "columns": 3
      },
      
      "group_posts": [
        {"telegram_id": 124, "media_url": "...", "is_hidden": false},
        {"telegram_id": 125, "media_url": "...", "is_hidden": false},
        {"telegram_id": 126, "media_url": "...", "is_hidden": true}
      ],
      
      "comments": [...]
    }
  ]
}
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–Ω–∞–ª–∞

```
PUT /api/v2/channels/{channel_id}/settings
```

**Request Body:**

```json
{
  "display": {
    "sort_order": "asc",
    "items_per_chunk": 100
  },
  "export": {
    "page_size": "A3",
    "margins": [15, 15, 15, 15]
  }
}
```

**Response:**

```json
{
  "success": true,
  "settings": {...}
}
```

### 3. –°–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑ –ø–æ—Å—Ç–∞

```
POST /api/v2/posts/{channel_id}/{telegram_id}/visibility
```

**Request Body:**

```json
{
  "hidden": true
}
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ layout –≥–∞–ª–µ—Ä–µ–∏

```
PUT /api/v2/layouts/{grouped_id}
```

**Request Body:**

```json
{
  "channel_id": "llamasass",
  "columns": 3,
  "border_width": "2",
  "no_crop": false,
  "regenerate": true  // –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å cells
}
```

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ chunks metadata (–¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)

```
GET /api/v2/channels/{channel_id}/chunks
```

**Response:**

```json
{
  "channel_id": "llamasass",
  "total_chunks": 5,
  "items_per_chunk": 50,
  "chunks": [
    {
      "index": 0,
      "posts_count": 48,
      "comments_count": 23,
      "date_from": "2025-12-25",
      "date_to": "2025-12-20"
    },
    ...
  ]
}
```

---

## üóÑÔ∏è –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ú–û–î–ï–õ–Ø–•

### Channel Model (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π)

```python
class Channel(db.Model):
    __tablename__ = 'channels'

    id = db.Column(db.String, primary_key=True)
    name = db.Column(db.String, nullable=False)
    avatar = db.Column(db.String, nullable=True)
    description = db.Column(db.Text, nullable=True)
    creation_date = db.Column(db.String, nullable=True)
    subscribers = db.Column(db.String, nullable=True)
    posts_count = db.Column(db.Integer, nullable=True)
    comments_count = db.Column(db.Integer, nullable=True)
    discussion_group_id = db.Column(db.BigInteger, nullable=True)
    
    # –ù–û–í–û–ï: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    settings = db.Column(JSON, nullable=False, default={
        "display": {
            "sort_order": "desc",
            "items_per_chunk": 50
        },
        "export": {
            "page_size": "A4",
            "margins": [20, 20, 20, 20],
            "include_comments": True
        }
    })
    
    # DEPRECATED: –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
    changes = db.Column(JSON, nullable=True)       # ‚Üí settings.display
    print_settings = db.Column(JSON, nullable=True) # ‚Üí settings.export
```

### –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
def migrate_channel_settings():
    """–ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç"""
    channels = Channel.query.all()
    
    for channel in channels:
        new_settings = {
            "display": {
                "sort_order": (channel.changes or {}).get("sortOrder", "desc"),
                "items_per_chunk": (channel.print_settings or {}).get("items_per_chunk", 50)
            },
            "export": {
                "page_size": (channel.print_settings or {}).get("page_size", "A4"),
                "margins": (channel.print_settings or {}).get("margins", [20, 20, 20, 20]),
                "include_comments": True
            }
        }
        channel.settings = new_settings
    
    db.session.commit()
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í API v2

```
api/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ posts.py           # –°—Ç–∞—Ä—ã–π API (v1) - –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ channels.py        # –°—Ç–∞—Ä—ã–π API (v1)
‚îú‚îÄ‚îÄ chunks.py          # –°—Ç–∞—Ä—ã–π API (v1)
‚îú‚îÄ‚îÄ layouts.py         # –°—Ç–∞—Ä—ã–π API (v1)
‚îú‚îÄ‚îÄ edits.py           # –°—Ç–∞—Ä—ã–π API (v1)
‚îÇ
‚îî‚îÄ‚îÄ v2/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ channels.py    # GET /api/v2/channels/{id}/posts
    ‚îÇ                  # PUT /api/v2/channels/{id}/settings
    ‚îÇ                  # GET /api/v2/channels/{id}/chunks
    ‚îÇ
    ‚îú‚îÄ‚îÄ posts.py       # POST /api/v2/posts/{channel}/{id}/visibility
    ‚îÇ
    ‚îú‚îÄ‚îÄ layouts.py     # PUT /api/v2/layouts/{grouped_id}
    ‚îÇ
    ‚îî‚îÄ‚îÄ serializers.py # –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```

---

## üîÑ –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò

### –§–∞–∑–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ API v2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å v1)

```
–î–µ–Ω—å 1-2:
‚îú‚îÄ‚îÄ [ ] –°–æ–∑–¥–∞—Ç—å api/v2/__init__.py
‚îú‚îÄ‚îÄ [ ] –°–æ–∑–¥–∞—Ç—å api/v2/serializers.py (–æ–±—â–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ [ ] –°–æ–∑–¥–∞—Ç—å api/v2/channels.py —Å GET posts endpoint
‚îú‚îÄ‚îÄ [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è v2 endpoints
‚îî‚îÄ‚îÄ [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å blueprint –≤ app.py

–î–µ–Ω—å 3:
‚îú‚îÄ‚îÄ [ ] –î–æ–±–∞–≤–∏—Ç—å PUT settings endpoint
‚îú‚îÄ‚îÄ [ ] –î–æ–±–∞–≤–∏—Ç—å POST visibility endpoint
‚îú‚îÄ‚îÄ [ ] –î–æ–±–∞–≤–∏—Ç—å PUT layouts endpoint
‚îî‚îÄ‚îÄ [ ] –¢–µ—Å—Ç—ã
```

### –§–∞–∑–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è Frontend

```
–î–µ–Ω—å 4-5:
‚îú‚îÄ‚îÄ [ ] –°–æ–∑–¥–∞—Ç—å services/apiV2.js
‚îú‚îÄ‚îÄ [ ] –°–æ–∑–¥–∞—Ç—å composables/useChannelPosts.js
‚îú‚îÄ‚îÄ [ ] –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å posts.vue –Ω–∞ API v2
‚îú‚îÄ‚îÄ [ ] –£–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É layouts/edits
‚îî‚îÄ‚îÄ [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–µ–Ω—å 6:
‚îú‚îÄ‚îÄ [ ] –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ù–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
‚îî‚îÄ‚îÄ [ ] –ö–Ω–æ–ø–∫–∏ Save/Reset
```

### –§–∞–∑–∞ 3: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ cleanup

```
–î–µ–Ω—å 7:
‚îú‚îÄ‚îÄ [ ] –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ Channel.changes ‚Üí Channel.settings
‚îú‚îÄ‚îÄ [ ] –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ Channel.print_settings ‚Üí Channel.settings
‚îú‚îÄ‚îÄ [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–µ–Ω—å 8:
‚îú‚îÄ‚îÄ [ ] Deprecation warnings –¥–ª—è v1 endpoints
‚îú‚îÄ‚îÄ [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API v2
‚îî‚îÄ‚îÄ [ ] Release notes
```

---

## üß™ –¢–ï–°–¢–´

### Unit —Ç–µ—Å—Ç—ã (api/v2/)

```python
# tests/test_api_v2_channels.py

def test_get_posts_default_params():
    """–ü–æ—Å—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"""
    response = client.get('/api/v2/channels/llamasass/posts')
    assert response.status_code == 200
    data = response.json
    
    assert data['applied_params']['sort_order'] == 'desc'
    assert data['applied_params']['source'] == 'default'
    assert len(data['posts']) > 0

def test_get_posts_url_override():
    """URL –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç"""
    # –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º sort_order = desc
    client.put('/api/v2/channels/llamasass/settings', json={
        'display': {'sort_order': 'desc'}
    })
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º asc
    response = client.get('/api/v2/channels/llamasass/posts?sort_order=asc')
    data = response.json
    
    assert data['applied_params']['sort_order'] == 'asc'
    assert data['applied_params']['source'] == 'url'

def test_posts_include_layout():
    """–ü–æ—Å—Ç—ã —Å grouped_id –≤–∫–ª—é—á–∞—é—Ç layout"""
    response = client.get('/api/v2/channels/llamasass/posts')
    
    grouped_posts = [p for p in response.json['posts'] if p.get('grouped_id')]
    for post in grouped_posts:
        assert 'layout' in post
        assert 'group_posts' in post

def test_posts_include_hidden_state():
    """–í—Å–µ –ø–æ—Å—Ç—ã –∏–º–µ—é—Ç is_hidden"""
    response = client.get('/api/v2/channels/llamasass/posts')
    
    for post in response.json['posts']:
        assert 'is_hidden' in post
        assert isinstance(post['is_hidden'], bool)

def test_chunking():
    """Chunking —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"""
    response = client.get('/api/v2/channels/llamasass/posts?chunk=0&items_per_chunk=10')
    data = response.json
    
    assert data['pagination']['current_chunk'] == 0
    assert len(data['posts']) <= 10
    assert data['pagination']['has_next'] == True
```

### Integration —Ç–µ—Å—Ç—ã

```python
# tests/test_api_v2_integration.py

def test_full_flow():
    """–ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É: –∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ"""
    
    # 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
    response = client.get('/api/v2/channels/llamasass/posts')
    original_order = response.json['applied_params']['sort_order']
    
    # 2. –ú–µ–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ URL
    response = client.get('/api/v2/channels/llamasass/posts?sort_order=asc')
    assert response.json['applied_params']['source'] == 'url'
    
    # 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
    client.put('/api/v2/channels/llamasass/settings', json={
        'display': {'sort_order': 'asc'}
    })
    
    # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
    response = client.get('/api/v2/channels/llamasass/posts')
    assert response.json['applied_params']['sort_order'] == 'asc'
    assert response.json['applied_params']['source'] == 'saved'
```

---

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê API v2

1. **–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –º–Ω–æ–≥–∏—Ö** ‚Äî –ø–æ—Å—Ç—ã + layouts + hidden states
2. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** ‚Äî —á—ë—Ç–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî —á–∏—Å—Ç—ã–µ endpoints —Å —è—Å–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî v1 –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
6. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

